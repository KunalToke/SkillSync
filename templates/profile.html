{% extends "base.html" %}
{% block content %}
<div class="container my-5">

  <!-- ================== Profile Header ================== -->
  <div class="card mb-4 shadow-sm">
    <div class="position-relative">
      <!-- Cover Photo (always default if not set) -->
      <img id="coverDisplay" 
           src="{{ user.cover_pic or url_for('static', filename='images/default-cover.jpg') }}" 
           class="w-100 rounded-top" style="height:220px; object-fit:cover;">

      <!-- Profile Picture (always default if not set) -->
      <div class="position-absolute" style="left:24px; bottom:-48px;">
        <img id="profileDisplay" 
             src="{{ user.profile_pic or url_for('static', filename='images/default-profile.png') }}" 
             class="rounded-circle shadow" width="96" height="96" 
             style="border:4px solid white; object-fit:cover;">
      </div>
    </div>
    <div class="card-body mt-4">
      <h3>{{ user.name or user.username }}</h3>
      <p class="text-muted">{{ user.headline or "Add a headline..." }}</p>
    </div>
  </div>

  <!-- ================== Main Profile Form ================== -->
  <form method="POST" enctype="multipart/form-data" id="profileForm">
    <!-- Basics -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5>Basic Information</h5>
        <div class="row g-3 mt-1">
          <div class="col-md-6">
            <label class="form-label">Full Name</label>
            <input name="name" class="form-control" value="{{ user.name or '' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Headline</label>
            <input name="headline" class="form-control" value="{{ user.headline or '' }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Location</label>
            <input name="location" class="form-control" value="{{ user.location or '' }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Relocation preference</label>
            <select name="relocation" class="form-select">
              <option value="No" {% if user.relocation=='No' %}selected{% endif %}>No</option>
              <option value="Yes" {% if user.relocation=='Yes' %}selected{% endif %}>Yes</option>
              <option value="Open" {% if user.relocation=='Open' %}selected{% endif %}>Open</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Contact Email</label>
            <input name="contact_email" class="form-control" value="{{ user.contact_email or user.email }}">
          </div>
        </div>
      </div>
    </div>

    <!-- About -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5>About / Bio</h5>
        <textarea name="about" class="form-control" rows="3">{{ user.about or '' }}</textarea>
      </div>
    </div>

    <!-- Resume -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5>Resume</h5>
        <input type="file" name="resume" accept=".pdf,.doc,.docx" class="form-control">
        {% if user.resume %}
          <a href="{{ url_for('profile.download_resume', username=user.username) }}" class="btn btn-sm btn-primary mt-2">Download Resume</a>
        {% endif %}
      </div>
    </div>

    <!-- Settings -->
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5>Privacy & Settings</h5>
        <div class="row">
          <div class="col-md-4">
            <label class="form-label">Profile Visibility</label>
            <select name="visibility" class="form-select">
              <option value="public" {% if user.visibility=='public' %}selected{% endif %}>Public</option>
              <option value="private" {% if user.visibility=='private' %}selected{% endif %}>Private</option>
              <option value="recruiters" {% if user.visibility=='recruiters' %}selected{% endif %}>Only Recruiters</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Resume Sharing</label>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" name="resume_sharing" {% if user.resume_sharing %}checked{% endif %}>
              <label class="form-check-label">Allow resume sharing</label>
            </div>
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-success w-100" type="submit">Save Profile</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
{% endblock %}
