{% extends "base.html" %}
{% block title %}SkillSync | Track Applications{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold"><i class="fas fa-file-signature text-primary"></i> Track Applications</h2>
    <a href="{{ url_for('talent_seekers.dashboard') }}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left"></i> Dashboard
    </a>
  </div>

  <!-- Pipeline -->
  <div class="row g-3 mb-4">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="mb-1">Hiring Pipeline</h6>
            <div class="d-flex gap-3 flex-wrap">
              {% for status, count in pipeline.items() %}
              <div class="text-center">
                <div class="badge bg-secondary fs-6">{{ status }}</div>
                <div class="fw-bold mt-1">{{ count }}</div>
              </div>
              {% endfor %}
            </div>
          </div>
          <small class="text-muted">Updated just now</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Application Cards -->
  <div class="row g-4">
    {% for a in applications %}
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="mb-0">{{ a.candidate }}</h5>
              <small class="text-muted">{{ a.job_title if a.job_title else 'N/A' }}</small>
            </div>
            <span class="badge 
              {% if a.status=='Hired' %}bg-success
              {% elif a.status=='Interview' %}bg-primary
              {% elif a.status=='Shortlisted' %}bg-warning text-dark
              {% else %}bg-secondary{% endif %}">
              {{ a.status }}
            </span>
          </div>

          <div class="mt-3 d-flex gap-3 flex-wrap">
            <div><div class="small text-muted">Applied</div><div>{{ a.applied_date.split('T')[0] }}</div></div>
            <div><div class="small text-muted">AI Match</div><div class="fw-bold">{{ a.match_score }}%</div></div>
            <div><div class="small text-muted">Offer Prob.</div><div class="fw-bold text-success">{{ a.offer_prediction }}%</div></div>
          </div>

          <div class="mt-2">
            <button class="btn btn-sm btn-outline-secondary btn-timeline" data-appid="{{ a.id }}">Journey</button>
            <button class="btn btn-sm btn-outline-primary btn-nudge" data-appid="{{ a.id }}">Nudge</button>
          </div>

          <hr>
          <strong>Team Notes</strong>
          <div class="small">
            {% if a.notes %}
              {% for n in a.notes|reverse %}
              <div class="mb-2">
                <strong>{{ n.author }}</strong> <small class="text-muted">{{ n.time.split('.')[0] }}</small>
                <div>{{ n.text }}</div>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-muted">No notes yet.</div>
            {% endif %}
          </div>

          <hr>
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <small class="text-muted">Portfolio:</small>
              {% if a.portfolio %}
                <a href="{{ a.portfolio }}" target="_blank" class="ms-2"><i class="fas fa-globe"></i> View</a>
              {% else %}
                <span class="text-muted ms-2">No portfolio</span>
              {% endif %}
            </div>
            <div>
              <small class="text-muted">Comms</small>
              <div class="progress" style="width:150px;">
                <div class="progress-bar" role="progressbar" style="width: {{ a.comm_score }}%;">
                  {{ a.comm_score }}%
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
